# 索引

## 索引定义

数据结构+算法
索引以文件形式存储在磁盘上

磁盘io流程：
程序调用内核，内核驱动磁柱磁头读取盘片数据，存到内存内核专用区域，再转化到mysql的专用内存区域
* 寻道：磁头前后移动；
* 旋转：盘片逆时针运动；**前两个步骤是主要耗时阶段**。
* 预读：按照文件块读取，4K*N，4K是最小单位，N可以指定，为了提高下次读取的速度，默认16K（MySQL一页）

## innodb存储引擎

frm文件--表结构
idb文件--数据

## 各种索引
### hash索引
* 键值唯一，哈希索引优势明显
* 无法完成范围查询
* 无法模糊查询
* 不支持联合索引
* 因为哈希碰撞效率低

## B+树


## innodb索引
主键索引
数据存储在叶子节点上

非主键索引
非主键索引中叶子节点存储的是**主键索引的id**


## 面试
### Innodb怎么保证必有主键
会生成uuid
### 为什么推荐整型自增主键 
整型数据比较快
插入数据会影响之前的索引结构
### 为什么非主键索引结构叶子节点存储的是主键值而不是数据
时间换空间
### innodb和myisam

- myisam数据不存在主键索引文件上

- innodb支持事务

- innodb支持外键

- innodb支持行级锁。mysiam不支持行级锁




myisam三个文件
* frm表结构
* MYD数据
* MYI索引
B+树索引存储的是数据的地址（innodb存的是数据）

### 联合索引
最左前原则
联合索引后边字段范围查询，可以使用前部分的索引



### 索引失效

1. like以%开始模糊查询
2. or左右两侧没有同时使用索引
3. 左前原则
4. 隐式转化 varchar
5. 判断是否值是NULL
6. 使用函数
7. 联合索引中遇到范围查询即停止不往后查找索引
8. 优化器索引预估检测全表扫描会更快

### 索引预估

explain

