# java锁

## 乐观锁
读的时候不加锁，修改的时候进行版本号比较，相同即加锁修改，否则重复。
## 悲观锁
读写都加锁。Synchronized
## 自旋锁
线程短时间cpu空转，否则线程要在阻塞挂起状态间切换

## 可重入锁

递归锁，递归函数里无需重复加锁，也不会阻塞。

**实现原理**：每一个锁关联着一个线程和一个计数器。调用一次上锁计数器加1，退出一个锁，计数器减1。计数器为0时释放锁。

## 偏向锁

某一个线程获取偏向锁，只需要置换一次线程id即可，是个乐观锁。遇到锁的争用会升级轻量级锁或者重量级锁

## 轻量级锁

基于CAS方式

1.建立栈帧锁空间lock record，存储对象头拷贝

2.拷贝对象头

3.CAS将对象锁指针指向自己

4.1.重置对象头状态00

4.2如果更新失败，检查是否已经指向自己，否的话自旋，自旋结束以后未获得锁升级为重量级锁。

## 重量级锁

使用monitor实现，依赖于操作系统底层的mutex lock（互斥量）实现，所以需要在用户态和内核态下进行切换。锁的，对象头中包含指向monitor互斥量的指针。monitor保存着锁拥有者的信息。